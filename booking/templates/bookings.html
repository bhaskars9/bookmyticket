

{% extends 'base.html' %}

{% load static %}
{% load utils %}

<!-- Header -->
{% block title %}
        <title>My Bookings </title>
        <style>
          .results{
            font-family: 'Lato', sans-serif;
          }
          .norounds{
            border-radius:0px;
          }
          table {
            text-align: center;
        }
        </style>
        <link href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" rel="stylesheet" />
{% endblock title %}


{% block content %}


{% comment %} <p> Raw Dataset: {{ data }} </p> {% endcomment %}
    <div class="container" id="movie-content">        
            {% comment %} Raw Queryset    {{ showtimes }} {% endcomment %}
            {% if msg %}
            <div class="alert alert-success alert-dismissible fade show" id="messageblk" role="alert">
              <strong>Holy guacamole!</strong> {{ msg }}
              <button type="button" class="btn-close messagealert" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endif %}
            <div class="row">
                <h2 class="text-primary"  >My Bookings</h2>
            </div>
            {% if data %}
            <table class="table table-dark table-hover">
                <thead>
                  <tr>
                    <th scope="col">Showdate</th>
                    <th scope="col">Movie</th>
                    <th scope="col">Showtime</th>
                    <th scope="col">Seats</th>
                    <th scope="col">Total ($$)</th>
                    <th scope="col">Booked</th>
                    <th scope="col">Status</th>
                  </tr>
                </thead>
                <tbody>
                 
                    {% for row in data %}
                  <tr>
                    <td>{{ row.show_date }}</td>
                    <td>{{ row.show__movie__movie_name }}</td>
                    <td>{{ row.show__showtime }}</td>
                    <td>{{ row.seat_num }}</td>
                    <td>${{ row.total }}</td>
                    <td>{{ row.booked_date|tdiff }}</td>
                    <td><a type="button" class="btn bstatusbtn" data-id="{{ row.id }}" >
                      {{ row.show_date|bstatus }}
                    </a></td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
              {% else %}
                  <p class="text-secondary">No booking have been made yet</p>
                  {% endif%}

    </div>

        <!-- Delete Confirmation Modal -->
        <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content bgdark">
              <div class="modal-header"  style="border-bottom: None;">
                <h5 class="modal-title" id="exampleModalLongTitle">Are you sure you want to cancel</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                Confirm your want to cancel your tickets by clicking Confirm.
              </div>
              <div class="modal-footer" style="border-top:None">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <a hre="#" class="btn btn-danger" id="finalConfirm" >Confirm</a>
              </div>
            </div>
          </div>
        </div>

{% endblock content %}
        
{% block js %}
<script>
$( document ).ready(function() {

  $(".bstatusbtn").each(function(){
    val = $(this).text();
    if(val.includes("Cancel")){
      console.log("cancel");
      $(this).addClass("btn");
      $(this).addClass("btn-danger");
    }
    else if (val.includes("watched")){
      console.log("watched");
      $(this).removeClass("bstatusbtn");

    }
  
    
  });


$(".bstatusbtn").click(function(){
  val = $(this).text();
  if(val.includes("Cancel")){
    console.log("cancel");
    bid = $(this).attr("data-id");
    console.log(bid);
    $("#finalConfirm").attr('href','/cancelbooking/'+bid)
  }
  else if (val.includes("watched")){
    console.log("watched");
  }

  $('#exampleModalCenter').modal('show');
});

$('.messagealert').click(function(){
  $("#messageblk").hide();
});
});
</script>
{% endblock %}